---
title: 'Wrangling: More Plots'
author: Bryan Li
tutorial:
  id: wrangling-more-plots
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: More plots because plots are cool.
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(lubridate)
library(stringr)
library(skimr)
library(primer.data)
library(ggdist)
library(knitr)
library(babynames)
library(ggthemes)

read.csv(ErrorNames.csv.html)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```

<!-- Delete useless comments. -->

<!-- Remove redundant instructions like "Copy paste your code." -->

<!-- Add last plot which does ROAS plots about percentage accounted for by top 10 names. See: https://github.com/avehtari/ROS-Examples/tree/master/Names. Use top_n() function. Group by year and gender. Keep only top 10 names. Then group_by(year). Then sum percentages. Then graph that. -->


<!-- Save below for later. -->

<!-- Difficult to understand what a geom_density shows, especially the meaning of the y-axis. Maybe we should have a section which walks students through the concepts of a distribution, ending with a smooth probability distribution. First, start with a geom_histogram example, but which looks like a standard plot. Or, maybe just use facet_wrap, stack them on top of each other. Raw counts of things are important. Second, use the same data, turns it into percentages using the after_stat() trickery. Third plot, use the same data, does this with geom_density(). Just an easier way of showing those shapes. Fourth plot, same data, use stat_slab().  BL: Is this already done? -->


<!-- Five examples, each of which needs to use pivot_longer (if needed) to put things in the same column and which then creates a "standard" plot with different levels on the y-axis. Those levels sometimes already exist in the data, like trains$party, and sometimes need to be created, like turning trains$income into 5 categories. [two use pivot_longer, somewhat unecessarily in shaming?. Those that do not use pivot_longer use mutate
to make groups and (one) to transform these group into factors as their "hard" wrangling technique.] -->

<!-- Use stuff other than stat_slab() for variety sake. Use geom_density in the first plot, maybe. And then geom_histogram() in the second plot, maybe with the same data! [see comment 4]  -->

<!-- Drop knuggets of wisdom about what these densities mean. Sometimes they are scaled and sometimes not. [see comment 3] -->

<!-- Example with trains which needs to get att_end and att_start in the same column so that you can plot them together with fill or whatever. [This may have been a better use of pivot_longer...] -->

<!-- Example with trains which transform income into a set of categories, as in class. [not done with trains, but see comment 6]  -->

<!-- Change phrasing of ggplot geom exercises -->

<!-- Is shaming too big since it makes it a 10 second step everytime you run the pipe? -->




## National Health and Nutrition Survey

### 

`nhanes` includes data from the "National Health and Nutrition Examination Survey," which contains the personal and physical information of 10,000 Americans from two surveys in 2009 and 2011.

### 

Let's create the following plot.

```{r}
nhanes_p1 <- nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi) %>% 
  ggplot(aes(x = bmi, fill = gender)) +
  geom_histogram(alpha = .5, bins = 100, position = "identity") +
  facet_wrap(~ depressed) +
  coord_cartesian(xlim = c(16, 60)) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Most participants reported not feeling depressed at all", 
       x = "BMI", 
       y = "Depression", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p1
```



### Exercise 1

Look at the help page for `nhane`.

```{r national-health-and--1, exercise = TRUE}

```

```{r national-health-and--1-hint-1, eval = FALSE}
?nhanes
```

### 

The 10,000 units (people) in the tibble are the equivalent of a random sample of 10,000 US residents.


### Exercise 2

Use the function `skim()` on the `nhanes` data set.

```{r national-health-and--2, exercise = TRUE}

```

```{r national-health-and--2-hint-1, eval = FALSE}
skim(...)
```

### 

Note that depressed is a factor. 

### Exercise 3

Start a pipe with the `nhanes` data set and `select()` the `gender`, `depressed`, and `bmi` columns.

```{r national-health-and--3, exercise = TRUE}

```

```{r national-health-and--3-hint-1, eval = FALSE}
... %>%
  select(..., ..., ...)
```

### Exercise 4

We can see that there are some NA values in `nhanes`. Ideally, we want to get rid of NA values. Start a pipe with `nhanes`. `select()` the three columns. Then use the function `drop_na()` to remove all NA values with the columns as the argument.

```{r national-health-and--4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--4-hint-1, eval = FALSE}
... %>%
  drop_na(..., ...)
```

### 

If we had not selected relevant columns before we dropped na values, observations with NA values in columns we don't care about would also be dropped, causing uncessary loss of data.

### Exercise 5

Now it's time to graph it. Continue piping your code with `ggplot()`. Inside `aes()`, map `bmi` to the x-axis, and `gender` to `fill`. Finally, add the layer `geom_histogram()`.

```{r national-health-and--5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--5-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(x = ..., 
                        fill = ...)) +
  geom_histogram()
```

### 

Remember that histogram has a default `y` which are the counts it tabulates for each bin from our data. 

### Exercise 6

Within `geom_histogram()`, set the argument `position` equal to "identity", set the argument `alpha` = `0.5`, and set the argument `bins` = 100. 

```{r national-health-and--6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--6-hint-1, eval = FALSE}
... %>% 
  geom_histogram(position = "...", alpha =  ..., 
                        bins = ...)) 
```

### 

For histogram and bar plots, `position` is by default "stacked", which stacks different colors of the same x value on top of one another. `position` being equal to "identity", makes it so that different colors overlap, which can be seen when the opacity of the colors is increased. 

### Exercise 7

Add the layer `facet_wrap()` to facet the histogram by `depressed`. 

```{r national-health-and--7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--7-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r national-health-and--7-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```


### 

Facet wrapping keeps the same y axis scale, which allows us to compare the sizes of data we have for each level of Depressed

### Exercise 8

Add the layer `coord_cartesian()` and  set the argument `xlim` equal to the vector `c(16, 60)`, which limits the x-axis domain to a minimum of 16 and a maximum of 60. 


```{r national-health-and--8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--8-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 9

Let's clean the graph up by adding the theme `theme_classic() `.

```{r national-health-and--9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--9-hint-1, eval = FALSE}
Recall that when you add a theme, you add a layer! Use the + operator.
```

```{r national-health-and--9-hint-2, eval = FALSE}
... +
  theme_classic() 
```

### Exercise 10

To finish your plot, add the layer `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption. To change the legend heading from the name of the tibble column, use the argument `fill`. 

```{r national-health-and--10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--10-hint-1, eval = FALSE}
... +
  labs(title = "..." ,
      subtitle = "...",
      x = "...",
      y = "..."
     fill = "...",
     caption = "...")
```


Reminder: This is what your plot should look like.

```{r nhanes9-answer}
nhanes_p1
```

### Exercise 11

The histogram plots the actual counts for each BMI bin, and the categories of Depressed with more data are taller. Other functions can plot probabilities for each bin, i.e. the count for each bin divided by the sum of the counts in all a graph's bin.

### 

Let's make the following plot.

```{r national-health-and--11}
nhanes_p2 <- nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi) %>% 
  ggplot(aes(x = bmi, fill = gender)) +
  geom_density(alpha = .5)  +
  facet_wrap(~ depressed) +
  coord_cartesian(xlim = c(16, 60)) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Depressed females who answered 'Most' are heavier than depressed males who answered 'Most'", 
       x = "BMI", 
       y = "Density", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p2
```


### 

We have provided you with the beginning of code for the last plot. Continue your pipe by adding `ggplot()`. Map `bmi` to the x-axis, and `gender` to `fill`. Add the layer `geom_density()`.  Within `geom_density()`, set `alpha` = .5.

```{r nhanes10, exercise = TRUE}
 nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi)
```

```{r national-health-and--11-hint-1, eval = FALSE}
... %>% 
ggplot(mapping = aes(..., fill = ...)) +
  geom_density(alpha = ...) 
```

### 

In addition to plotting probabilities instead of counts, `geom_density()` smooths out the histogram. 

### Exercise 12

Using the code above, add the layer `facet_wrap()` to facet the histogram by `depressed`. 

```{r national-health-and--12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--12-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r national-health-and--12-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```


### 

Facet wrapping keeps the same y axis scale, which allows us to compare the sizes of data we have for each level of Depressed

### Exercise 13

Add the layer `coord_cartesian` and  set the argument `xlim` equal to the vector `c(16, 60)`, which limits the x-axis domain to a minimum of 16 and a maximum of 60. 

```{r national-health-and--13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--13-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```

### Exercise 14

Add the layer `theme_classic() ` to adjust the feel of your plot. Finally, add labels to your graph. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r national-health-and--14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--14-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(title = "..." ,
       subtitle = "...",
       x = "...",
       y = "...",
     fill = "...",
     caption = "...")

```

Reminder: This is what your plot should look like.

```{r nhanes13-answer}
nhanes_p2
```


### Exercise 15

In the exercises above, we facet wrapped the graphs for the three Depressed categories using a Density curve. However, our curves were vertical. Density curves and their distribution are so much easier to look at when compared along the x-axis. Let's do that.


### 

Let's make the following plot.

```{r national-health-and--15}
nhanes_p3 <- nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi) %>% 
  ggplot(aes(x = bmi, y = depressed, fill = gender)) +
  stat_slab(alpha = .5)  +
  coord_cartesian(xlim = c(16, 50)) +
  scale_y_discrete(labels = c("No Days", "Several Days", "Most Days")) +
  labs(title = "BMI and Days Depressed",
       subtitle = "Most often depressed femaes have highest BMI among both sexes", 
       x = "BMI", 
       y = "Days Depressed", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p3
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`. Map `bmi` to the x-axis, `depressed` to the y-axis, and `gender` to `fill`. Add the layer `stat_slab()`.  Within `stat_slab()`, set `alpha` = .5. 

```{r nhanes14, exercise = TRUE}
 nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi) 
```

```{r national-health-and--15-hint-1, eval = FALSE}
... %>% 
ggplot(aes(x = , y = , fill = ...)) +
  stat_slab(alpha = ...) 
```

### 

Notice that adding `depressed` to the y-axis has done something similar to what faceting did in our previous graphs. Stacking in this method can be done with `stat_slab()` which is part of the package `ggdist`. 

### Exercise 16

Add the layer `coord_cartesian`. Let's alter our maximum to 50 so that we get a better focus on the peaks of the graph. Set `xlim` equal to the vector `c(16, 50)`, which limits the x-axis domain to a minimum of 16 and a maximum of 50. 

```{r national-health-and--16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--16-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 17

Add the layer `scale_y_discrete()`. Set the argument `labels` equal to a vector of strings `c("No Days, " Several Days", "Most Days")`. 

```{r national-health-and--17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r national-health-and--17-hint-1, eval = FALSE}
  ... +
  scale_y_discrete(labels = ...) +
  ... +
```

```{r national-health-and--17-hint-2, eval = FALSE}
  ... +
  scale_y_discrete(labels = c("No Days", "Several Days", "Most Days")) +
  ... +
```


### 

The vector renames the y-axis breaks from bottom to top based on the respective names given in the vector.
We use discrete because the y-axis measures discrete, as opposed to continuous or binned, variables.

### Exercise 18

Let's clean the graph up by adding the layer `theme_classic() `. Now add the `labs()` layer. As you set the labels, pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r national-health-and--18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r national-health-and--18-hint-1, eval = FALSE}
... +
  theme_classic() +
  labs(title = "...",
       subtitle = "...", 
       x = "...", 
       y = "...", 
       fill = "...",
       caption = "...")

```

Reminder: This is what your plot should look like.

```{r nhanes17-answer}
nhanes_p3
```



## Michigan voter experiment

### 

The `shaming` data set measures the impact of social pressure on voting. Nearly 350,000 people in Michigan were randomly assigned to 1 of 5 treatment groups before the 2006 Michigan primary. All 5 groups were sent mail before the primary: The "Civic Duty" group had an extra reminder that voting was a civic responsibility. The "Hawthorne" group was told that whether or not they voted, their decision would not be in the public record. The "Self" group was actually *sent* the public record of whether or not they voted in 2004. The "Neighbors" group was sent both their voting record and their neighbors' voting record from 2004. They then measured the impact of these "social pressures" on their choice to vote.

### 

Let's create the following plot

```{r make-shaming1}
shaming_p1 <- shaming %>% 
  mutate(id = 1:length(primary_06)) %>% 
  pivot_longer(cols = primary_00:general_04,
               names_to = "year",
               values_to = "voted") %>% 
  mutate(voted = if_else(voted == "Yes", 1, 0)) %>% 
  pivot_wider(names_from = year, 
              values_from = voted) %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, 
                        primary_04, general_04)) %>% 
  mutate(vote_sum = as.character(vote_sum),
         primary_06 = as.character(primary_06)) %>% 
  ggplot(aes(age, fill = primary_06)) +
    geom_histogram(alpha = 0.5, bins = 30, position = "identity") +
    facet_wrap(~ vote_sum) + 
    coord_cartesian(xlim = c(20, 90)) +
    scale_fill_manual(values = c("#F8766D", "#00BFC4"), 
                      labels = c("Did not vote", "Voted")) +
    theme_classic() +
    labs(title = "Age Distributions by Voting History",
         subtitle = 
           "Those who have voted more are more likely to vote in the 2006 primary", 
         x = "Age", 
         y = "Number of Times Voted", 
         fill = "Voted in 2006 Primary",
         caption = "Gerber, Green, and Larimer (2008)") 

shaming_p1
```

### Exercise 1

`skim()` the `shaming` data set.

```{r michigan-voter-exper-1, exercise = TRUE}

```

```{r michigan-voter-exper-1-hint-1, eval = FALSE}
skim(...)
```

### 

Note that this data set has no missing values. 

### Exercise 2

Let's convert the voting records for the election before the 2006 primary into a binary system (using only 0 and 1 as answers). We will use `pivot_longer()` to transform the six columns into one column. Then we will make the change into binary. Then we use `pivot_wider()` to transform the data back into the original format. *However*,  since there is no column that uniquely identifies each row, `pivot_wider()` cannot match data with the data that belonged to its original row. We've run into a problem.



### 

Let's solve this problem. We must create a variable that uniquely identifies each row. Begin a pipe the `shaming` data set. Then use `mutate` to create the column `id`. Inside `mutate`, set `id` equal to the expression `1:length(primary_06)`(an expression for an integer series starting from 1 and ending with the number of rows in the column `primary_06`)

```{r michigan-voter-exper-2, exercise = TRUE}

```

```{r michigan-voter-exper-2-hint-1, eval = FALSE}
... %>% 
  mutate(id = ...)
```

```{r michigan-voter-exper-2-hint-2, eval = FALSE}
... %>% 
  mutate(id = 1:length(primary_06))
```

### 

By default, `pivot_wider()` attempts to use all columns to define unique rows. In many data sets, these columns provide uniquely identifying information on their own. 


### Exercise 3

Now we can start making this a binary system. We first use `pivot_longer()` to combine the contents of the columns from `primary_00` to `general_04` into one column.Then, we set the column names to go to a new column called `"election"` and the values to go to a column called, `"voted"`. Remember that you can use the `:` to make consecutive column selection easier. 

```{r michigan-voter-exper-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-3-hint-1, eval = FALSE}
... %>% 
  pivot_longer(cols = ...:...,
               ...)
```

```{r michigan-voter-exper-3-hint-2, eval = FALSE}
pivot_longer(cols = primary_00:general_04,
             names_to = "...",
             values_to = "...")
```

### 

Because the columns we have selected are consecutive, we can use the `:` to more quickly name them as a group. Look at the `tidyr_tidy_select` help page for more operators which make it easier to select variables. 


### Exercise 4

Now it's time to change this into a binary system. Use `mutate()` to change the `voted` column into a column of the same name, but which has `1` and `0` instead of `"Yes"` and `"No"`. Inside the `mutate()`, set `voted` equal to an `if_else()` function whose condition is `voted ==  "Yes"`. Set the results, for if true and false, to be `1` and `0`, respectively. 

```{r michigan-voter-exper-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-4-hint-1, eval = FALSE}
... %>% 
 mutate(voted = if_else(voted == "...", 1, ...))
```


### Exercise 5

Use `pivot_wider()` to transform the contents of `voted` back into six columns. Set the names of these new columns to come from `election` and their values to come from `voted`

```{r michigan-voter-exper-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-5-hint-1, eval = FALSE}
... %>% 
pivot_wider(names_from = ..., 
              values_from = ...)
```

### 

Notice how quotes are not needed when referring to existing columns in `pivot_wider()` but are needed when creating new columns in `pivot_longer()`.



### Exercise 6

After that, add the function `rowwise()` to your pipe. Then use `mutate()` to create a new column called `vote_sum`. Inside `mutate()`, set `vote_sum` equal to the sum of the columns from `primary_00` to `general_04`.

```{r michigan-voter-exper-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r michigan-voter-exper-6-hint-1, eval = FALSE}
... %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, 
                        primary_04, general_04))
```

### 

If we did not use `rowwise()` here, `mutate()` would interpret the sum as a summing together of all the rows in each of these six columns. The new column would have the same, very large value throughout all of its rows.



### Exercise 7

Use `mutate()` to change the `vote_sum` column into a column of the same name, whose contents are characters rather than numbers. Use the `as.character()` function. 

```{r michigan-voter-exper-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r michigan-voter-exper-7-hint-1, eval = FALSE}
mutate(... = as.character(...))
```

```{r michigan-voter-exper-7-hint-2, eval = FALSE}
mutate(vote_sum = as.character(vote_sum))
```

### 

We are using these numbers which represent vote histories as different categories for our age distributions. Later when we put these on the y-axis, numeric form would confuse `ggplot()` because it would think we are putting a continuous variable on the y-axis. 


### Exercise 8

Now use a new `mutate()` to change the `primary_06` column into a column of the same name, whose contents are characters rather than numbers. Use the `as.character()` function. 

```{r michigan-voter-exper-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r michigan-voter-exper-8-hint-1, eval = FALSE}
... %>% 
  mutate(... = as.character(...))
```

```{r michigan-voter-exper-8-hint-2, eval = FALSE}
... %>% 
  mutate(primary_06 = as.character(primary_06))
```

### 

Likewise, when we use `primary_06`as a fill, `ggplot()` if it were a numeric variable.



### Exercise 9

Now, `select()` the columns relevant for our plot: `age`, `vote_sum`, and `primary_06`.

```{r michigan-voter-exper-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-9-hint-1, eval = FALSE}
... %>% 
select(..., ..., ...)
```


### Exercise 10

Now it's time to graph it. Continue your pipe with `ggplot()`. Map `age` to the x-axis, and `primary_06` to `fill`. Add the layer `geom_histogram()`.

```{r michigan-voter-exper-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-10-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(x = ..., 
                        fill = ...)) +
  geom_histogram()
```

### 

Remember that histogram has a default `y` which are the counts it tabulates for each bin from our data. 


### Exercise 11

Within `geom_histogram()`, set the argument `position` equal to `"identity"`, set the argument `alpha` = `0.5`, and set the argument `bins` = 30. 

```{r michigan-voter-exper-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-11-hint-1, eval = FALSE}
... %>% 
  geom_histogram(position = "identity", alpha =  ..., 
                        bins = ...)
```

### 

For histogram and bar plots, `position` is by default `"stacked"`, which stacks different colors of the same x value on top of one another. `position` being equal to `"identity"`, makes it so that different colors overlap, and that both can be seen when the opacity of the colors is increased. 


### Exercise 12

Add the layer `facet_wrap()` to facet the histogram by `vote_sum`. 

```{r michigan-voter-exper-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-12-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r michigan-voter-exper-12-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```


### Exercise 13

Add the layer `coord_cartesian` and  use the argument to limit the x-axis domain to a minimum of 20 and a maximum of 90 

```{r michigan-voter-exper-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-13-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```



### Exercise 14

Ok now what we're going to do is add the layer `scale_fill_manual` to change the legend options from `0` and `1` to `Did not vote` and `vote`. Add `scale_fill_manual` and set the first argument `values`, which determines the fill colors, equal to `c("#F8766D", "#00BFC4")`, the default red and blue in ggplot. 3. Set the second argument `labels` equal to `c("Did not vote", "Voted")`

```{r michigan-voter-exper-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-14-hint-1, eval = FALSE}
... +
  scale_fill_manual(values = c("...", "..."), labels = c("...", "..."))
```


### Exercise 15

Adjust the feel of the graph by adding the theme `theme_classic() `. To finish your plot, use `labs()` to give the graph a title, subtitle, axes labels, legend heading, and caption.

```{r michigan-voter-exper-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-15-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(... ,
     fill = "...",
     ...)
```

Reminder: This is what your plot should look like.



```{r shaming15-answer}
shaming_p1
```



### Exercise 16

Let's make the following plot, but this time, we're using density plots to visualize the same data.

```{r michigan-voter-exper-16}
shaming_p2 <- shaming %>% 
  mutate(id = 1:length(primary_06)) %>% 
  pivot_longer(cols = primary_00:general_04,
               names_to = "year",
               values_to = "voted") %>% 
  mutate(voted = if_else(voted == "Yes", 1, 0)) %>% 
  pivot_wider(names_from = year, 
              values_from = voted) %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, primary_04, general_04)) %>% 
  mutate(vote_sum = as.character(vote_sum),
         primary_06 = as.character(primary_06)) %>% 
  select(age, vote_sum, primary_06) %>% 
  ggplot(aes(x = age, fill = primary_06)) +
  geom_density(alpha = 0.3) +
  facet_wrap(~ vote_sum) + 
  coord_cartesian(xlim = c(20, 90)) +
  scale_fill_manual(values = c("#F8766D", "#00BFC4"), labels = c("Did not vote", "Voted")) +
  theme_classic() +
  labs(title = "Age Distributions by Voting History",
       subtitle = "Among those of the same voting history, those who voted in the \n 2006 primary are of generally similar ages to those who did not", 
       x = "Age", 
       y = "Density", 
       fill = "2006 Primary",
       caption = "Gerber, Green, and Larimer (2008)") 
  
shaming_p2
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`. Map `age` to the x-axis, and `primary_06` to `fill`. Add the layer `geom_density()`. Within `geom_density()`, set `alpha` equal to 0.3.

```{r shaming16, exercise = TRUE}
shaming %>% 
  mutate(id = 1:length(primary_06)) %>% 
  pivot_longer(cols = primary_00:general_04,
               names_to = "year",
               values_to = "voted") %>% 
  mutate(voted = if_else(voted == "Yes", 1, 0)) %>% 
  pivot_wider(names_from = year, 
              values_from = voted) %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, primary_04, general_04)) %>% 
  mutate(vote_sum = as.character(vote_sum),
         primary_06 = as.character(primary_06)) %>% 
  select(age, vote_sum, primary_06) 
```

```{r michigan-voter-exper-16-hint-1, eval = FALSE}
... %>% 
  ggplot(aes(..., fill = ...)) +
  geom_density(alpha = ...) 
```

### Exercise 17

Add the layer `facet_wrap()` to facet the histogram by `vote_sum`. Add the layer `coord_cartesian` and use the argument to limit the x-axis domain to a minimum of 20 and a maximum of 90. 

```{r michigan-voter-exper-17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-17-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r michigan-voter-exper-17-hint-2, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 18

Ok now we're gonna add the layer `scale_fill_manual` to change the legend options from `0` and `1` to `Did not vote` and `vote`. Add the layer `scale_fill_manual` and set the first argument `values`, which determines the fill colors,  equal to `c("#F8766D", "#00BFC4")`, the default red and blue in ggplot. Set the second argument `labels` equal to `c("Did not vote", "Voted")`. 

```{r michigan-voter-exper-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-18-hint-1, eval = FALSE}
... +
  scale_fill_manual(values = c("...", "..."), labels = c("...", "..."))
```


### Exercise 19

Adjust the feel of your graph by adding `theme_classic() `. Finally, add labels to your graph. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. If, as in our example, the subtitle is too long insert `\n` at the point in your subtitle where you would like a new line. 

```{r michigan-voter-exper-19, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-19-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(... ,
    subtitle = "...\n..."
     fill = "...",
     ...)
```

Reminder: This is what your plot should look like.

```{r shaming19-answer}
shaming_p2
```


### 

Plot outputs have a margin about the size of the R markdown margin. For overlong subtitles such as the one we used in the example, `ggplot()` will not wrap them automatically. To create a new line, insert `\n` meaning "new-line" at the appropriate point. `ggplot()` will print the following text on a new line and will not print `\n`. 

### Exercise 20

Let's create the following plot, using another `ggdist` function to  visualize the same data with point interval graphs. 

```{r michigan-voter-exper-20}
shaming_p3 <- shaming %>% 
  mutate(id = 1:length(primary_06)) %>% 
  pivot_longer(cols = primary_00:general_04,
               names_to = "year",
               values_to = "voted") %>% 
  mutate(voted = if_else(voted == "Yes", 1, 0)) %>% 
  pivot_wider(names_from = year, 
              values_from = voted) %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, primary_04, general_04)) %>% 
  mutate(vote_sum = as.character(vote_sum),
         primary_06 = as.character(primary_06)) %>% 
  select(age, vote_sum, primary_06) %>% 
  ggplot(aes(x = age, y = vote_sum, color = primary_06)) +
  stat_pointinterval(position = "dodge") +
  scale_color_manual(values = c("#F8766D", "#00BFC4"), labels = c("Did not vote", "Voted")) +
  theme_classic() +
  labs(title = "Age Distributions by Voting History",
       subtitle = "With the exception of the youngest, those who voted in the 2006 \n primary were always slightly older than those who did not", 
       x = "Age", 
       y = "Number of Times Voted",
       color = "2006 Primary",
       caption = "Gerber, Green, and Larimer (2008)") 

shaming_p3
```

### 

The middle point represents the mean of the distribution, the bolded line represents the 25th to 75th percentile, and the unbolded line represents the 5th to 95th percentiles. 

### 

We have provided you with the beginning of code for the last plot (Again, you are so very welcome). Continue your pipe with `ggplot()`.  Map `age` to the x-axis, `vote_sum` to the y-axis, and `primary_06` to `color`. Add the layer `stat_pointinterval()` and specify `position` to be `"dodge"`.

```{r shaming20, exercise = TRUE}
shaming %>% 
  mutate(id = 1:length(primary_06)) %>% 
  pivot_longer(cols = primary_00:general_04,
               names_to = "year",
               values_to = "voted") %>% 
  mutate(voted = if_else(voted == "Yes", 1, 0)) %>% 
  pivot_wider(names_from = year, 
              values_from = voted) %>% 
  rowwise() %>% 
  mutate(vote_sum = sum(primary_00, general_00, primary_02, general_02, primary_04, general_04)) %>% 
  mutate(vote_sum = as.character(vote_sum),
         primary_06 = as.character(primary_06)) %>% 
  select(age, vote_sum, primary_06)
```

```{r michigan-voter-exper-20-hint-1, eval = FALSE}
... %>% 
  ggplot(aes(..., color = ...)) +
  stat_pointinterval() 
```

### 

We use `color` instead of `fill` since we are dealing with lines rather than filled shapes. 

### Exercise 21

Add the layer `coord_cartesian` and  use the argument to limit the x-axis domain to a minimum of 20 and a maximum of 81, since none of our distributions have a 95th percentile greater than 81.  

```{r michigan-voter-exper-21, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-21-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 22

Ok now we're gonna add the layer `scale_color_manual` to change the legend options from `0` and `1` to `Did not vote` and `Voted`. Use `scale_color_manual` and set the first argument `values`, which determines the fill colors, equal to `c("#F8766D", "#00BFC4")`, the default red and blue in ggplot. 3. Set the second argument `labels` equal to `c("Did not vote", "Voted")`

```{r michigan-voter-exper-22, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-22-hint-1, eval = FALSE}
... +
  scale_color_manual(values = c("...", "..."), labels = c("...", "..."))
```


### 

Just as you mapped to `color` instead of `fill`, you must use `scale_color_manual` in place of `scale_fill_manual`.

### Exercise 23

Now adjust the feel of your graph by adding `theme_classic() `. Finally, add labels to your graph. Use `color` rather than `fill` as we have done above. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r michigan-voter-exper-23, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r michigan-voter-exper-23-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(... ,
     fill = "...",
     ...)
```

Reminder: This is what your plot should look like.



```{r shaming22-answer}
shaming_p3
```



## Harvard Q-Guide

### 

The `qscores` data set includes information about 748 courses at Harvard during the 2018-2019 school year, including their department, student enrollment, average time spent on homework, and the average student rating of the course.

### 

Let's create the following plot

```{r make-qscores1}
qscores_p1 <- qscores %>% 
 mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 50  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+")) %>% 
  mutate(enrollment_groups = factor(enrollment_groups,
                                    levels = c("16-30", "30-50", "50-100", "100+"))) %>% 
  mutate(introduction = str_detect(name, "Introduction")) %>% 
  select(rating, enrollment_groups, introduction) %>% 
  ggplot(aes(rating, fill = introduction)) +
  geom_histogram(position = "identity", bins = 30) +
  facet_wrap(~ enrollment_groups) +
  coord_cartesian(xlim = c(1, 5)) +
  theme_clean() +
  labs(title = "Ratings Distribution by Enrollment",
       subtitle = 'The largest classes have the greatest proportion of \n "Introduction" classes.',
       x = "Rating",
       y = "Count",
       caption = "Harvard College",
       fill = '"Introduction" in Course Title') 

qscores_p1
```

### Exercise 1

Run `c(min(qscores$enrollment), mean(qscores$enrollment), max(qscores$enrollment))` to produce a vector with the minimum, mean and maximum enrollment value in this data. Run the equivalent command for `rating`.

```{r harvard-qguide-1, exercise = TRUE}

```

### 

Notice how much closer the mean rating is to the maximum than the minimum. 

### Exercise 2

Based on the quartiles for enrollment, let's create a column that groups the classes into four different groups based on enrollment size. Start a new pipe from `qscores`. Use `mutate()` to create a new column called `enrollment_groups`. Set `enrollment_groups` equal to the function `case_when()`, which can take multiple arguments of the syntax `enrollment >= 16 & enrollment < 30 ~ "16-30"`.The part left of the `~` is the condition, and the part right of the `~` is the result when the condition is met. Using this example as the first, create four groups, named "16-30", "30-50", "50-100", and "100+". 

```{r harvard-qguide-2, exercise = TRUE}

```

```{r harvard-qguide-2-hint-1, eval = FALSE}
... %>% 
mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            ...)
```

```{r harvard-qguide-2-hint-2, eval = FALSE}
... %>% 
  mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 30  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+"))
```

### 

If you  forget the `=` in `>=` you may accidentally exclude data.


### Exercise 3

Recall our first two graphs for the NHANES data. When we faceted, the `depressed` facets were automatically put in order from least to greatest (None, Several, Most) without any input from us. By default, ggplot defaults to alphanumeric order, but because `depressed` was a factor its variables already had an order which overrode ggplot's default. If we were to facet by `enrollment_groups` with the default, `100+` would precede `16-30` in alphanumeric order. To do this, we must make `enrollment_groups` a factor. 


### 

Let's start making `enrollment_groups` a factor. Use `mutate` to change the column `enrollment_groups` into a column of the same name, but with factor variables. Set `enrollment_groups` equal to `factor()`. Within `factor()`,  the first argument is the column we want to make a factor, and the second argument is `levels` which should be set equal to the four different enrollment group names in the order in which we want them to appear, `c("16-30", "30-50", "50-100", "100+")`. 

```{r harvard-qguide-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r harvard-qguide-3-hint-1, eval = FALSE}
... %>% 
 mutate(enrollment_groups = factor(...,
                                    levels = ...))
```

```{r harvard-qguide-3-hint-2, eval = FALSE}
... %>% 
 mutate(enrollment_groups = factor(enrollment_groups,
                                    levels = c("16-30", "30-50", "50-100", "100+")))
```

### 

Levels are always identical to the data contained within the column. 



### Exercise 4

Now let's create a column that has value `TRUE` whenever a course has `"Introduction"` in its title and `FALSE` when it does not. 

Use `mutate()` to create a new column, called `introduction` and set it equal to the function str_detect(). The first argument should be the column through which you want to search and the second should be the pattern for which you are searching. 

```{r harvard-qguide-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-4-hint-1, eval = FALSE}
... %>% 
  mutate(... = str_detect(name, "Introduction"))
```

### 

`str_detect` only has this function, to detect the presence or absence of a string by returning `TRUE` or `FALSE`. 


### Exercise 5

Next `select()` the columns relevant for our plot `rating`, `enrollment_groups`, and `introduction`. 

```{r harvard-qguide-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-5-hint-1, eval = FALSE}
... %>% 
select(..., ..., ...)
```


### Exercise 6

Continue your pipe with `ggplot()`. Map `rating` to the x-axis, and `introduction` to `fill`. Add the layer `geom_histogram()`.

```{r harvard-qguide-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-6-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(x = ..., 
                        fill = ...)) +
  geom_histogram()
```

### 

Remember that histogram has a default `y` which are the counts it tabulates for each bin from our data. 



### Exercise 7

Within `geom_histogram()`, set the argument `position` equal to "identity", set `alpha` to 0.5 set the argument `bins` = 30. 

```{r harvard-qguide-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-7-hint-1, eval = FALSE}
... %>% 
  geom_histogram(position = "identity", alpha =  ..., 
                        bins = ...)) 
```

### 

For histogram and bar plots, `position` is by default "stacked", which stacks different colors of the same x value on top of one another. `position` being equal to "identity", makes it so that different colors overlap, and that both can be seen when the opacity of the colors is increased. 


### Exercise 8

Now add the layer `facet_wrap()` to facet the histogram by `enrollment_groups`. 

```{r harvard-qguide-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-8-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r harvard-qguide-8-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```


### Exercise 9

Add the layer `coord_cartesian` and  use the argument to limit the x-axis domain to a minimum of 1 and a maximum of 5. 

```{r harvard-qguide-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-9-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(..., ...))
```


### Exercise 10

Adjust the feel of the graph by adding the theme `theme_clean()`. Use `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption. To use a quotation marks in labels, such as in our example with "Introduction", enclose the whole string in single quotes instead of double quotes. 

```{r harvard-qguide-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-10-hint-1, eval = FALSE}
... +
  theme_clean() +
  labs(... ,
       subtitle  = '..."Introduction"...'
       fill = "...",
       ...)
```

Reminder: This is what your plot should look like.

```{r qscores10-answer}
qscores_p1
```



### Exercise 11

Let's make the following plot, using density plots to visualize the same data.

```{r harvard-qguide-11}
qscores_p2 <- qscores %>% 
 mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 50  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+")) %>% 
  mutate(enrollment_groups = factor(enrollment_groups, levels = c("16-30", "30-50", "50-100", "100+"))) %>% 
  mutate(introduction = str_detect(name, "Introduction")) %>% 
  select(rating, enrollment_groups, introduction) %>% 
  ggplot(aes(rating, fill = introduction)) +
  geom_density(alpha = 0.5, position = "identity") + 
  facet_wrap(~ enrollment_groups) +
  coord_cartesian(xlim = c(1, 5)) +
  theme_classic() +
  labs(title = "Ratings Distribution by Enrollment", 
       subtitle = '"Introduction" classes have lower ratings than other classes',
       x = "Rating", 
       y = "Density",
       caption = "Harvard College", 
       fill = '"Introduction" in Course Title')

qscores_p2
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`.  Map `rating` to the x-axis, and `introduction` to `fill`. Add the layer `geom_density()`. Within `geom_density()`, set `alpha` equal to 0.5. 

```{r qscores11, exercise = TRUE}
qscores %>% 
 mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 50  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+")) %>% 
  mutate(enrollment_groups = factor(enrollment_groups, levels = c("16-30", "30-50", "50-100", "100+"))) %>% 
  mutate(introduction = str_detect(name, "Introduction")) %>% 
  select(rating, enrollment_groups, introduction)
```

```{r harvard-qguide-11-hint-1, eval = FALSE}
... %>% 
  ggplot(aes(..., fill = ...)) +
  geom_density(alpha = ...) 
```

### Exercise 12

Add the layer `facet_wrap()` to facet the histogram by `enrollment_groups`. Add the layer `coord_cartesian` and use the argument to limit the x-axis domain to a minimum of 1 and a maximum of 5. 

```{r harvard-qguide-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-12-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r harvard-qguide-12-hint-2, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 13

Now let's make the graph prettier by adding `theme_classic() `. Finally, add labels to your graph. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r harvard-qguide-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-13-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(... ,
     fill = "...",
     ...)
```

Reminder: This is what your plot should look like.

```{r qscores13-answer}
qscores_p2
```



### Exercise 14

Let's make the following plot, using another `ggdist` function, `stat_halefeye` to visualize the same data with both the distributions (as in `stat_slab`) and plot intervals. 

```{r harvard-qguide-14}
qscores_p3 <- qscores %>% 
 mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 50  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+")) %>% 
  mutate(enrollment_groups = factor(enrollment_groups, 
                                    levels = c("16-30", "30-50", "50-100", "100+"))) %>% 
  mutate(introduction = str_detect(name, "Introduction")) %>% 
  select(rating, enrollment_groups, introduction) %>% 
  ggplot(aes(rating, enrollment_groups, fill = introduction, color = introduction)) +
  stat_halfeye(alpha  =  0.5) + 
  coord_cartesian(xlim = c(2.7, 5)) +
    theme_classic() +
  labs(title = "Ratings Distribution by Enrollment", 
       subtitle = 'Class ratings generally decrease as in enrollment increases, \n though this is not the case with introductory courses.',
x = "Rating", 
y = "Entollment",
caption = "Harvard College", 
fill = '"Introduction" in Course Title', 
color = '"Introduction" in Course Title') 

qscores_p3
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`. Map `rating` to the x-axis, `enrollment_groups` to the y-axis, `introduction` to `fill`, **and** `introduction` to **color**. Add the layer `stat_halfeye()`. Within `stat_halfeye()`, set `alpha` equal to 0.5.

```{r qscores14, exercise = TRUE}
qscores %>% 
 mutate(enrollment_groups = case_when(enrollment >= 16 & enrollment < 30 ~ "16-30",
            enrollment >= 30 &  enrollment < 50  ~ "30-50",
            enrollment >= 50 & enrollment < 100 ~ "50-100",
            enrollment >= 100 ~ "100+")) %>% 
  mutate(enrollment_groups = factor(enrollment_groups, levels = c("16-30", "30-50", "50-100", "100+"))) %>% 
  mutate(introduction = str_detect(name, "Introduction")) %>% 
  select(rating, enrollment_groups, introduction)
```

```{r harvard-qguide-14-hint-1, eval = FALSE}
... %>% 
  ggplot(aes(..., ..., fill = ..., )) +
  stat_halfeye(alpha = ...) 
```

### 

We map `introduction` to both `fill` and `color` since our graph includes both a filled shape and a line. 

### Exercise 15

Add the layer `coord_cartesian` and  use the argument to limit the x-axis domain to a minimum of 2.7 and a maximum of 5, so that we can better focus on the peaks of the distributions. 

```{r harvard-qguide-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-15-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...))
```


### Exercise 16

Let's make it pretty now :) Adjust the feel of your graph by adding `theme_classic() `. Finally, add labels to your graph. You need to rename both `fill` and `color` with the same name. Pay particular attention to how the y-axis label and subtitle should change compared to the previous plot. 

```{r harvard-qguide-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r harvard-qguide-16-hint-1, eval = FALSE}
... +
  theme_classic()  +
  labs(... ,
     fill = "...",
     ...)
```

### 

If you only rename either `fill` or `color` and not both, `ggplot` will assume you want two different legends, one for `fill` with one title, and another for `color` with another title. 

Reminder: This is what your plot should look like.

```{r qscores16-answer}
qscores_p3
```



## Kenya voter registration experiment

### 

The `kenya` contains data from a study in which poll stations in Kenya were assigned to either the control group or a group in which one or more methods (an SMS reminder, canvassing, etc.) were used to encourage voter registration. 

### 

Let's create the following plot.

```{r make-kenya1}
kenya_p1 <- kenya %>% 
  mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            poverty >= .35 &  poverty < .43  ~ "2",
            poverty >= .43 & poverty < .49 ~ "3",
            poverty >= .49 ~ "4")) %>% 
  mutate(poverty_groups = factor(poverty_groups, 
                                    levels = c("1", "2", 
                                    "3", "4"), 
                                    labels = c("1st Quartile (Least Poverty)", "2nd Quartile", 
                                    "3rd Quartile", "4th Quartile (Most Poverty)"))) %>% 
  mutate(age_groups = case_when(mean_age < 41.5  ~ "1",
                                mean_age >= 41.5  ~ "2")) %>% 
  select(reg_byrv13, poverty_groups, age_groups) %>% 
  drop_na() %>%
  ggplot(aes(reg_byrv13, fill = age_groups)) +
  geom_histogram(bins = 500, position = "stack") +
  facet_wrap(~ poverty_groups) +
  coord_cartesian(xlim = c(.005, .15), ylim = c(0, 160)) +
  scale_x_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("#F8766D", "#00BFC4"), labels = c("Below 50th Percentile", "Above 50th Percentile")) +
  theme_classic() +
  labs(title = "Distribution of New Registered Voters by Poverty and Age Groups",
       subtitle = "The poorest districts have fewer zero and near-zero percent \n increases and more districts of unusually high increase",
       x = "Percent of New Registered Voters", 
       y = "Count", 
       fill = "Mean Age in District",
       caption = "Harris, Kamindo, Van der Windt (2020)") 

kenya_p1
```


### Exercise 1

Run `c(min(kenya$poverty), mean(kenya$poverty), max(kenya$poverty))` to produce a vector with the minimum, mean, and maximum poverty rate in this data. Run the equivalent function for `mean_age`.

```{r kenya-voter-registra-1, exercise = TRUE}

```

### Exercise 2

Based on the quartiles above, let's create a column that groups the classes into four different groups based on enrollment size. Start a new pipe from `kenya`. Use `mutate()` to create a new column called `poverty_groups`. Set `poverty_groups` equal to the function `case_when()`, which can take multiple arguments of the syntax `poverty >= .18 & poverty < .35 ~ "1st Quartile"`.The part left of the `~` is the condition, and the part right of the `~` is the result when the condition is met. Using this example as the first, create four groups, named "1", "2", "3", and "4". 

```{r kenya-voter-registra-2, exercise = TRUE}

```

```{r kenya-voter-registra-2-hint-1, eval = FALSE}
... %>% 
mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            ...)
```

```{r kenya-voter-registra-2-hint-2, eval = FALSE}
... %>% 
  mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            poverty >= .35 &  poverty < .43  ~ "2",
            poverty >= .43 & poverty < .66 ~ "3",
            poverty >= .66 ~ "4")
```

### 

If you  forget the `=` in `>=` you may accidentally exclude data.


### Exercise 3

Recall how in our final plot with the NHANES data, we used `scale_y_discrete()` to change the `labels`, which changed the label on the graph into something clearer without changing the corresponding values in the data. Recall also how we have used `scale_color_manual` to change legend options to appear differently than they do within our data set. There is no equivalent function when we `facet_wrap()`. Instead, we treat the variable we want to facet by into a `factor` and change the label of this `factor`. 

### 

Let's do that. Use `mutate` to change the column `poverty_groups` into a column of the same name, but with factor variables. Set `poverty_groups` equal to `factor()`. Within `factor()`, the first argument should be the column we want to make a factor. The second argument is `levels` which should be set equal to the four different enrollment group names in the order in which we want them to appear, `c("1", "2", "3", "4")`. The third argument is `labels` which should be set equal to the names we want the respective levels to have on the graph, `c("1st Quartile (Least Poverty)", "2nd Quartile", "3 Quartile", "4th Quartile (Most Poverty)")`

```{r kenya-voter-registra-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-3-hint-1, eval = FALSE}
... %>% 
 mutate(poverty_groups = factor(...,
                                   levels = ..., 
                                   labels = ...))
```

```{r kenya-voter-registra-3-hint-2, eval = FALSE}
... %>% 
   mutate(poverty_groups = factor(poverty_groups, 
                                    levels = c("1", "2", 
                                    "3", "4"), 
                                    labels = c("1st Quartile (Least Poverty)", "2nd Quartile", 
                                    "3rd Quartile", "4th Quartile (Most Poverty)")))
```

### 

By default in `factor()`, `labels` is set equal to `levels`. 


### Exercise 4

Based on the 50th percentile for `mean_age`, use `mutate()` and `case_when()` to create a new column called `age_groups`, which has a value of `"1"` when the value of `mean_age` is  below the 50th percentile and a `"2"` when the value of `mean_age` is above the 50th percentile. 

```{r kenya-voter-registra-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-4-hint-1, eval = FALSE}
... %>% 
  mutate(... = case_when(.... < ...  ~ "1",
                         ...  >= ... ~ "2")
```

```{r kenya-voter-registra-4-hint-2, eval = FALSE}
... %>% 
  mutate(age_groups = case_when( ... < 41.5  ~ "1",
                                 ... >= 41.5  ~ "2")) 
```


### Exercise 5

`select` the columns relevant for our plot `reg_byrv13`, `poverty_groups`, and `age_groups`. 

```{r kenya-voter-registra-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-5-hint-1, eval = FALSE}
... %>% 
select(..., ..., ...)
```


### Exercise 6

Let's graph it. Continue your pipe with `ggplot()`. Map `reg_byrv13` to the x-axis, and `age_groups` to `fill`. Add the layer `geom_histogram()`.

```{r kenya-voter-registra-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-6-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(x = ..., 
                        fill = ...)) +
  geom_histogram()
```


### 

Remember that histogram has a default `y` which are the counts it tabulates for each bin from our data. 

### Exercise 7

Within `geom_histogram()`, set the argument `position` equal to `"stack"` and set the argument `bins` equal to 500. 

```{r kenya-voter-registra-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-7-hint-1, eval = FALSE}
... %>% 
  geom_histogram(position = "stacked", bins = ...)) 
```

### 

For histogram and bar plots, `position` is by default "stacked" for `geom_histogram()`, so including it is unnecessary. Stacked position lets us see the total count for each bin more easily. Because we are not dealing with overlap, there is no need for alpha here. 


### Exercise 8

Now let's make it into the graph we saw in the beginning. Add the layer `facet_wrap()` to facet the histogram by `poverty_groups`. 

```{r kenya-voter-registra-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-8-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r kenya-voter-registra-8-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) %>%  
```


### Exercise 9

Add the layer `coord_cartesian` and use the argument `xlim` to limit the x-axis domain to a minimum of 0 and a maximum of .15. Use the argument `ylim` to limit the y-axis range to a minimum of 0 and a maximum of 160. 

```{r kenya-voter-registra-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-9-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(...,...), ylim = c(...,...))
```


### Exercise 10

Because our x-axis measures percent increase, add the layer `scale_x_continuous` and set the argument `labels` equal to `scales::percent_format()`. 

```{r kenya-voter-registra-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-10-hint-1, eval = FALSE}
... +
  scale_x_continuous(labels = scale::percent_format())
```

### Exercise 11

Add the layer `scale_fill_manual` to change the legend options from `1` and `2` to `"Below 50th Percentile"` and `"Above 50th Percentile"`. The first argument is `values` which determines the fill colors, set this equal to `c("#F8766D", "#00BFC4")`, the default red and blue in ggplot. Set the second argument `labels` equal to a vector of our new names. (Below 50th Percentile and Above 50th Percentile)

```{r kenya-voter-registra-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-11-hint-1, eval = FALSE}
... +
  scale_fill_manual(values = c("...", "..."), labels = c("...", "..."))
```


### Exercise 12

Adjust the feel of the graph by adding the theme `theme_classic()`. To finish your plot, use `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption.

```{r kenya-voter-registra-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

Reminder: This is what your plot should look like.

```{r kenya-answer}
kenya_p1
```




### Exercise 13

Let's create the following plot, using density plots to visualize the same data. 

```{r kenya-voter-registra-13}
kenya_p2 <- kenya %>% 
  drop_na(mean_age) %>% 
  mutate(poverty_groups = 
           case_when(poverty >= .18 & 
                     poverty < .35 ~ "1",
                     poverty >= .35 & poverty < .43 ~ "2",
                    poverty >= .43 & poverty < .49 ~ "3",
poverty >= .49 & poverty < .90 ~ "4" )) %>% 
mutate(poverty_groups=factor(poverty_groups, levels=c("1","2","3","4"),
labels=c("1st Quartile (Least Poverty)", "2nd Quartile", "3 Quartile", "4th Quartile (Most Poverty)"))) %>% 
mutate(age_groups=case_when(mean_age > 41.58 ~ "2",
mean_age < 41.58 ~ "1"))  %>% 
select(reg_byrv13, poverty_groups, age_groups) %>% 
  ggplot(mapping=aes(x=reg_byrv13, fill=age_groups)) + 
  geom_density(alpha=.5, color=NA) +
  facet_wrap(~poverty_groups) +
  coord_cartesian(xlim=c(0, .25)) +
  scale_x_continuous(labels=scales::percent_format()) + 
  scale_fill_manual(values=c("#F8766D", "#00BFC4"), labels=c("Below 50th Percentile", "Above 50th Percentile")) +
  theme_classic() +
  labs(title="Distribution of New Registered Voters by Age Group",
  subtitle="Younger districts tend to have more zero and near-zero percent increases",
  x="Percent of New Registered Voters",
  y="Density",
  fill="Mean Age",
  caption="Harris, Kamindo, Van der Windt (2020)")

kenya_p2
```

### 

We have provided you with the beginning of code for the last plot. Continue your pipe with `ggplot()`. Add the layer `geom_density()`. Map `reg_byrv13` to the x-axis, and `age_groups` to `fill`. Within `geom_density()`, set `alpha` equal to 0.5 **and** set `color` = `NA`.

```{r kenya13, exercise = TRUE}
  kenya %>% 
  mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            poverty >= .35 &  poverty < .43  ~ "2",
            poverty >= .43 & poverty < .49 ~ "3",
            poverty >= .49 ~ "4")) %>% 
  mutate(poverty_groups = factor(poverty_groups, 
                                    levels = c("1", "2","3", "4"), 
                                    labels = c("1st Quartile (Richest)", "2nd Quartile", 
                                    "3rd Quartile", "4th Quartile (Poorest)"))) %>% 
  mutate(age_groups = case_when(mean_age < 41.5  ~ "1",
                                     mean_age >= 41.5  ~ "2")) %>% 
  select(reg_byrv13, treatment, poverty_groups, age_groups) %>% 
  drop_na()
```

```{r kenya-voter-registra-13-hint-1, eval = FALSE}
... %>% 
  ggplot(aes(..., fill = ...)) +
  geom_density(alpha = ..., color = NA) 
```

### 

`NA` should be written without quotes. By setting color equal to `NA` we will produce density plots without the outline. This will make our graph easier to read as we will not have to differentiate between the black of the x-axis and the black outline, which is a problem for values very close to 0. 

### Exercise 14

Now add the layer `facet_wrap()` to facet the histogram by `poverty_groups`. Add the layer `coord_cartesian` and use the argument `xlim` to limit the x-axis domain to a minimum of 0 and a maximum of .25. 

```{r kenya-voter-registra-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-14-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r kenya-voter-registra-14-hint-2, eval = FALSE}
... +
  coord_cartesian(xlim = c(0, .25))
```


### Exercise 15

Add the layer `scale_x_continuous` and set the argument `labels` equal to `scales::percent_format()`. Then, add the layer `scale_fill_manual`. Set `values` equal to `c("#F8766D", "#00BFC4")`, the default red and blue in ggplot and set `labels` equal to a vector of the new names, `"Below 50th Percentile"` and `"Above 50th Percentile"`.

```{r kenya-voter-registra-15, exercise = TRUE}

```

```{r kenya-voter-registra-15-hint-1, eval = FALSE}
... +
  scale_x_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("...", "..."), labels = c("...", "..."))
```

### 

Make sure to pay attention to order whenever you are setting `labels` with vectors. The position of the label in the vector should correspond to the current position of what you want to change on the graph. 


### Exercise 16

Adjust the feel of the graph by adding the theme `theme_classic()`. To finish your plot, use `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption.

```{r kenya-voter-registra-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

Reminder: This is what your plot should look like.

```{r kenya16-answer}
kenya_p2
```


### Exercise 17

Let's create the following plot.

```{r kenya-voter-registra-17}
kenya_p3 <- kenya %>% 
  mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            poverty >= .35 &  poverty < .43  ~ "2",
            poverty >= .43 & poverty < .49 ~ "3",
            poverty >= .49 ~ "4")) %>% 
  mutate(age_groups = case_when(mean_age < 41.5  ~ "1",
                                     mean_age >= 41.5  ~ "2")) %>% 
  select(reg_byrv13, poverty_groups, age_groups) %>% 
  drop_na() %>%
  ggplot(aes(reg_byrv13, fill = poverty_groups, y = age_groups)) +
  stat_slab(position = "dodge") +
  coord_cartesian(xlim = c(0, .25)) +
  scale_x_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#C77CFF"),
                    limits = c("4", "3", "2", "1"),
                    labels = c("4th Quartile (Most Poverty)", "3rd Quartile",
                                                 "2nd Quartile", "1st Quartile (Least Poverty)")) +
  scale_y_discrete(limits = c("2", "1"), 
                   labels = c("Above 50th Percentile", "Below 50th Percentile")) +
  labs(title = "Distribution of New Registered Voters by Poverty and Age Groups",
       subtitle = "Poorer districts have a greater proportion of higher increases \n both in younger districts and in older districts",
       x = "Percent of New Registered Voters", 
       y = "", 
       fill = "Poverty",
       caption="Harris, Kamindo, Van der Windt (2020)") +
  theme_classic()

kenya_p3
```

### 

We have provided you with the beginning of code for the last plot. However, because we are no longer faceting, we have removed the lines where we mutated `poverty_groups` into a factor. 

### 

Continue your pipe with `ggplot()`. Map `reg_byrv13` to the x-axis, `age_groups` to the y-axis and `poverty_groups` to `fill`. Add the layer `stat_slab()`.  Within `stat_slab()`, set `position` to "dodge".

```{r kenya17, exercise = TRUE}
kenya %>% 
  mutate(poverty_groups = case_when(poverty >= .18 & poverty < .35 ~ "1",
            poverty >= .35 &  poverty < .43  ~ "2",
            poverty >= .43 & poverty < .49 ~ "3",
            poverty >= .49 ~ "4")) %>% 
  mutate(age_groups = case_when(mean_age < 41.5  ~ "1",
                                     mean_age >= 41.5  ~ "2")) %>%
  select(reg_byrv13, poverty_groups, age_groups) %>% 
  drop_na()
```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-17-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(..., fill = ...)) +
  stat_slab(position=...) 
```

### 


### Exercise 18

Add the layer `coord_cartesian` and use the argument `xlim` to limit the x-axis domain to a minimum of 0 and a maximum of .25. 

```{r kenya-voter-registra-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-18-hint-1, eval = FALSE}
... +
  coord_cartesian(xlim = c(0, .25))
```


### Exercise 19

Now add the layer `scale_x_continuous` and set the argument `labels` equal to `scales::percent_format()`. 

```{r kenya-voter-registra-19, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-19-hint-1, eval = FALSE}
... +
  scale_x_continuous(... = scales::percent_format()) +
```

### 

Make sure to pay attention to order whenever you are setting `labels` with vectors. The position of the label in the vector should correspond to the current position of what you want to change on the graph. 


### Exercise 20

Although the factor labels we had previously would have worked, since you are not facet wrapping you do not have to change them that way. To change axis or legend `labels` you use `scale...()` functions, as you have done several times before. In addition to changing the legend labels, let us experiment by reversing the legend order using the `limits` argument. 

### 

 Add the layer `scale_fill_manual`. Set the argument `values` equal to `c("#F8766D", "#7CAE00", "#00BFC4", "#C77CFF")` which are the hex codes for the default red, green, blue, and purple, respectively in the legend. Set `limits` equal to the current legend options (which are identical to those in our data frame) in the order you want, `c("4", "3", "2", "1")`. Finally, set `labels` equal to a vector of the names which you want to appear in the legend, corresponding to the **new** order specified in limits. 

```{r kenya-voter-registra-20, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-20-hint-1, eval = FALSE}
... +
scale_fill_manual(values = c("...", "...", "...", "..."),
                    limits = c("...", "...", "...", "..."),
                    labels = c("...", "...", "...", "..."))
```

```{r kenya-voter-registra-20-hint-2, eval = FALSE}
... +
scale_fill_manual(... = c("#F8766D", "#7CAE00", "#00BFC4", "#C77CFF"),
                    limits = c("4", "3", "2", "1"),
                    ... = c("4th Quartile (Most Poverty)", "3rd Quartile",
                                                 "2nd Quartile", "1st Quartile (Least Poverty)"))
```


### Exercise 21

Add the layer `scale_y_discrete()`. Set the first argument to `limits` and set it equal to `c("2", "1")`. See how we reversed the order. Then set the second argument to `labels` and set it equal to `c("Above 50th Percentile", "Below 50th Percentile")`. 

With this, we are changing the legend items from `1` and `2` to "Above/Below 50th Percentile". The syntax is identical to the previous exercise, except that `scale_y_discrete()` does not require the `values` argument. 


```{r kenya-voter-registra-21, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kenya-voter-registra-21-hint-1, eval = FALSE}
... +
scale_y_discrete(... = c("2", "1"), 
                   ... = c("Above 50th Percentile", "Below 50th Percentile")
```

```{r kenya-voter-registra-21-hint-2, eval = FALSE}
... +
scale_y_discrete(limits = c("2", "1"), 
                   ... = c("Above 50th Percentile", "Below 50th Percentile")
```


### Exercise 22

Adjust the feel of the graph by adding the theme `theme_classic()`. To finish your plot, use `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption.

```{r kenya-voter-registra-22, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

Reminder: This is what your plot should look like.

```{r kenya22-answer}
kenya_p3
```

<!-- NL: Addition to show some of the difficulties in manipulating `geom_col()`.  -->




## Column graph

### 

We will be using the same data as the Michigan voter experiment, but instead of using histograms, we will be using a column graph to illustrate the data. 

```{r vis-c-plot}
ggplot(data = trains, 
                aes(x = race, fill = line)) +
  geom_bar(aes(y = after_stat(count/sum(count)))) +
  facet_wrap(~treatment) + 
  theme_classic() +
  labs(title = "Starting Attitudes Toward Immigration Issue",
       subtitle = "Higher proportion of minorities among treated participants",
       x = "Race",
       y = "Percentage of Participants",
       fill = "Line",
       caption = "Source: Enos (2014)")
```

### 

Let's use `geom_col()` to make this plot, in which the y-axis value is the percent of a race in one treatment group, not among all participants. 

```{r make-col-plot}
col_p  <- trains  %>% 
  select(race, line, treatment) %>% 
  group_by(treatment) %>% 
  mutate(treatment_total = n()) %>% 
  ungroup() %>% 
  mutate(individual_perc = 1 / treatment_total) %>% 
  ggplot(aes(x = race, y = individual_perc, fill = line)) +
  geom_col() +
  facet_wrap(~ treatment) +
  theme_classic() +
  scale_y_continuous(limits = c(0, 1), labels = scales::percent_format()) +
  labs(title = "Starting Attitudes Toward Immigration Issue",
       subtitle = "Higher proportion of minorities among treated participants",
       x = "Race",
       y = "Percentage of Participants",
       fill = "Line",
       caption = "Source: Enos (2014)") 

col_p
```

### Exercise 1

`skim()` the `trains` data set.

```{r column-graph-1, exercise = TRUE}

```

```{r column-graph-1-hint-1, eval = FALSE}
skim(...)
```

### 

Note that there are four unique race variables. 

### Exercise 2

Start a pipe with the `trains` data set. Then`select()` the `race`, `line`, and `treatment` columns. 

```{r column-graph-2, exercise = TRUE}

```

```{r column-graph-2-hint-1, eval = FALSE}
... %>%
  select(..., ..., ...)
```

### Exercise 3

Let's create a column whose value is the total number of members in the treatment group of the unit, i.e. the person described by the row. First, copy paste the previous code. Then `group` the data by the variable `treatment`.

```{r column-graph-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-3-hint-1, eval = FALSE}
... %>%
  group_by(treatment)
```

### 

In the box towards the upper left hand corner, we can see that this created two groups. 


### Exercise 4

Copy paste the code above. Now use `mutate()` to make a new column called `treatment_total()` which is equal to the number of units in each group. 

```{r column-graph-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-4-hint-1, eval = FALSE}
... %>%
  mutate(treatment_total = n())
```

### 

This column should have two unique values, corresponding to the two different treatment groups. 


### Exercise 5

Use `ungroup()` to remove the grouping. 

```{r column-graph-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-5-hint-1, eval = FALSE}
... %>%
  ungroup()
```

### 

Note that `group_by()` affects `mutate()` operations just as it affects `summarize()` operations. 


### Exercise 6

Let's create a column which records the percentage of the treatment group a single individual represents. Use `mutate()` to create a new column named `individual_perc` which is equal to `1 / treatment_total`.

```{r column-graph-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-6-hint-1, eval = FALSE}
... %>%
  mutate(individual_perc = 1/treatment_total)
```


### Exercise 7

Continue your pipe with `ggplot()`. Map `race` to the x-axis, `individual_perc` to the y-axis, and `line` to `fill`. Add the layer `geom_col()`.

```{r column-graph-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-7-hint-1, eval = FALSE}
... %>% 
  ggplot(mapping = aes(x = ..., y = ...,
                        fill = ...)) +
  geom_col()
```

### 

<!-- NL: This would be good to add to the textbook. A tutorial exercise which demonstrates this (and uses alpha to understand position = identity overlap) would be good.  -->

`geom_col()` adds up the individual percentages in each column which creates the total percentage for each race. This is because the `position` argument in `geom_col()` defaults to "stack". A `position` of `"identity"` would plot each unit starting from the y = 0 such that they overlap one another. 

### 

Note that these added percentages are not correct as graphed because we calculated the individual percentage based on the treatment group, not the total. 


### Exercise 8

Now add the layer `facet_wrap()` to facet the histogram by `treatment`. 

```{r column-graph-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-8-hint-1, eval = FALSE}
Within facet_wrap(), remember to put a ~ before the variable you want to facet by.
```

```{r column-graph-8-hint-2, eval = FALSE}
... + 
  facet_wrap(~...) 
```

### 

Facet wrapping keeps the same y axis scale, which allows us to compare the sizes of data we have for each level.


### Exercise 9

Add the layer `scale_y_continuous`. Set the argument `limits` equal to the vector `c(0, 1)` and set the argument `labels` equal to `scales::percent_format()`.


```{r column-graph-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-9-hint-1, eval = FALSE}
... +
    scale_y_continuous(limits = c(..., ...), labels = scales::percent_format())
```


### Exercise 10

Adjust the feel of the graph by adding the theme `theme_classic() `.

```{r column-graph-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-10-hint-1, eval = FALSE}
... +
  theme_classic() 
```


### Exercise 11

To finish your plot, use `labs()` to give the graph a title, subtitle, axis labels, legend heading, and caption. To change the legend heading from the name of the tibble column, use the argument `fill`. 

```{r column-graph-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r column-graph-11-hint-1, eval = FALSE}
... +
  labs(... ,
     fill = "...",
     ...)
```

Reminder: This is what your plot should look like.

```{r show-col-plot}
col_p
```

### 

Here's a video of Vine clips to enjoy. You're welcome :)

```{r echo = FALSE}

knitr::include_app("https://www.youtube.com/embed/S68mwCawjdQ")


```




```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
